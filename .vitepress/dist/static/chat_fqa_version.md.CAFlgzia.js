import{_ as l,c as i,o as e,ag as r}from"./chunks/framework.BHAHxt1l.js";const u=JSON.parse('{"title":"更新升级指南","description":"","frontmatter":{},"headers":[],"relativePath":"chat/fqa/version.md","filePath":"chat/fqa/version.md","lastUpdated":1737634698000}'),s={name:"chat/fqa/version.md"};function t(n,a,o,d,h,c){return e(),i("div",null,a[0]||(a[0]=[r(`<h1 id="更新升级指南" tabindex="-1">更新升级指南 <a class="header-anchor" href="#更新升级指南" aria-label="Permalink to &quot;更新升级指南&quot;">​</a></h1><p>本指南将帮助您完成系统的更新升级操作，包括在线升级和手动升级两种方式，并提供常见问题的解决方案。</p><h2 id="更新操作" tabindex="-1">更新操作 <a class="header-anchor" href="#更新操作" aria-label="Permalink to &quot;更新操作&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">⚠️ 警告</p><ul><li><strong>重要提示</strong>：更新前请务必备份数据库和源码目录，防止更新失败！</li><li><strong>重要提示</strong>：更新前请务必备份数据库和源码目录，防止更新失败！</li><li><strong>重要提示</strong>：更新前请务必备份数据库和源码目录，防止更新失败！</li></ul></div><h3 id="方式-1-在线升级" tabindex="-1">方式 1：在线升级 <a class="header-anchor" href="#方式-1-在线升级" aria-label="Permalink to &quot;方式 1：在线升级&quot;">​</a></h3><h4 id="适用条件" tabindex="-1">适用条件 <a class="header-anchor" href="#适用条件" aria-label="Permalink to &quot;适用条件&quot;">​</a></h4><ul><li>未进行二次开发或改变目录结构。</li><li>必须逐个版本升级。</li></ul><h4 id="操作步骤" tabindex="-1">操作步骤 <a class="header-anchor" href="#操作步骤" aria-label="Permalink to &quot;操作步骤&quot;">​</a></h4><ol><li><p><strong>关闭防跨站攻击</strong>：</p><ul><li>登录宝塔面板，点击【网站列表】，选择项目网站【设置】-&gt;【网站目录】，临时去掉【防跨站攻击(open_basedir)】。</li><li><img src="https://doc.mddai.cn/docs/images/general/php/update/update-1-1.png" alt="关闭防跨站攻击"></li></ul></li><li><p><strong>重启 Nginx</strong>：</p><ul><li>点击【软件商店】，找到 Nginx，选择【设置】-&gt;【重启】。</li><li><img src="https://doc.mddai.cn/docs/images/general/php/update/update-1-2.png" alt="重启 Nginx"></li></ul></li><li><p><strong>重启 PHP</strong>：</p><ul><li>点击【软件商店】，找到 PHP-8.0，选择【服务】-&gt;【重启】。</li><li><img src="https://doc.mddai.cn/docs/images/general/php/update/update-1-3.png" alt="重启 PHP"></li></ul></li><li><p><strong>在线更新</strong>：</p><ul><li>登录后台，点击【系统设置】-&gt;【系统维护】-&gt;【系统更新】，点击【一键更新】。</li></ul></li><li><p><strong>恢复防跨站攻击</strong>：</p><ul><li>更新完成后，重新开启【防跨站攻击(open_basedir)】。</li></ul></li><li><p><strong>清理缓存</strong>：</p><ul><li>登录后台，点击【系统设置】-&gt;【系统维护】-&gt;【系统缓存】-&gt;【清理缓存】。</li></ul></li><li><p><strong>重新发布小程序</strong>：</p><ul><li>更新后，小程序需要重新发布。</li></ul></li></ol><hr><h3 id="方式-2-手动升级到最新版本" tabindex="-1">方式 2：手动升级到最新版本 <a class="header-anchor" href="#方式-2-手动升级到最新版本" aria-label="Permalink to &quot;方式 2：手动升级到最新版本&quot;">​</a></h3><h4 id="操作步骤-1" tabindex="-1">操作步骤 <a class="header-anchor" href="#操作步骤-1" aria-label="Permalink to &quot;操作步骤&quot;">​</a></h4><ol><li><p><strong>备份关键文件</strong>：</p><ul><li>备份原项目的以下文件： <ul><li><code>server/.env</code></li><li><code>server/config/install.lock</code></li><li><code>server/public/uploads</code></li><li><code>server/license/my.license</code></li></ul></li></ul></li><li><p><strong>替换源码</strong>：</p><ul><li>下载最新的源码包，删除原项目的 <code>server</code> 目录，替换为源码包中的 <code>server</code> 目录。</li><li>将备份的文件还原到对应的位置。</li></ul></li><li><p><strong>更新数据库结构</strong>：</p><ul><li>如果正式上线的项目数据表前缀不是 <code>ai_</code>，需将 <code>like.sql</code> 中的前缀替换为实际前缀。</li><li>在本地或线上新建一个数据库，导入 <code>like.sql</code>。</li><li>使用工具（如 Navicat）同步新数据库的数据结构到线上项目。</li></ul></li></ol><hr><h2 id="更新常见问题" tabindex="-1">更新常见问题 <a class="header-anchor" href="#更新常见问题" aria-label="Permalink to &quot;更新常见问题&quot;">​</a></h2><h3 id="_1-在线升级提示未授权" tabindex="-1">1. 在线升级提示未授权 <a class="header-anchor" href="#_1-在线升级提示未授权" aria-label="Permalink to &quot;1. 在线升级提示未授权&quot;">​</a></h3><h4 id="_1-ip-未授权" tabindex="-1">① IP 未授权 <a class="header-anchor" href="#_1-ip-未授权" aria-label="Permalink to &quot;① IP 未授权&quot;">​</a></h4><ul><li>联系客服获取授权文件证书 上传文件到指定文件目录内</li></ul><h4 id="_2-域名未授权" tabindex="-1">② 域名未授权 <a class="header-anchor" href="#_2-域名未授权" aria-label="Permalink to &quot;② 域名未授权&quot;">​</a></h4><ul><li>如果站点配置了多个域名，授权文件只支持单域名。删除未授权的域名即可。</li><li><img src="https://doc.mddai.cn/docs/images/general/php/update/multiple-domain.png" alt="多域名问题"></li></ul><hr><h3 id="_2-在线升级失败的其他原因" tabindex="-1">2. 在线升级失败的其他原因 <a class="header-anchor" href="#_2-在线升级失败的其他原因" aria-label="Permalink to &quot;2. 在线升级失败的其他原因&quot;">​</a></h3><h4 id="_1-提示关闭跨域攻击" tabindex="-1">① 提示关闭跨域攻击 <a class="header-anchor" href="#_1-提示关闭跨域攻击" aria-label="Permalink to &quot;① 提示关闭跨域攻击&quot;">​</a></h4><ul><li>确保已关闭防跨站攻击，并重启 Nginx 和 PHP。</li><li><img src="https://doc.mddai.cn/docs/images/general/php/update/update-error.jpg" alt="跨域攻击提示"></li></ul><h4 id="_2-出现-500-错误" tabindex="-1">② 出现 500 错误 <a class="header-anchor" href="#_2-出现-500-错误" aria-label="Permalink to &quot;② 出现 500 错误&quot;">​</a></h4><ul><li><strong>目录结构改变</strong>：二开或目录结构改变会导致无法升级。</li><li><strong>目录权限不足</strong>：确保项目目录权限设置为 <code>www</code> 用户。</li><li><strong>缺少 ZipArchive</strong>：确保 PHP 已安装 <code>ZipArchive</code> 扩展。</li><li><img src="https://doc.mddai.cn/docs/images/general/php/update/ZipArchive.png" alt="ZipArchive 缺失"></li></ul><hr><h2 id="老版本必做" tabindex="-1">老版本必做 <a class="header-anchor" href="#老版本必做" aria-label="Permalink to &quot;老版本必做&quot;">​</a></h2><h3 id="安装配置-redis" tabindex="-1">安装配置 Redis <a class="header-anchor" href="#安装配置-redis" aria-label="Permalink to &quot;安装配置 Redis&quot;">​</a></h3><ol><li><p><strong>安装 Redis</strong>：</p><ul><li>在宝塔面板中安装 Redis 和 PHP 的 Redis 扩展。</li></ul></li><li><p><strong>配置 Redis</strong>：</p><ul><li>打开 <code>server/.env</code> 文件，添加以下配置：<div class="language-plaintext vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">plaintext</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[QUEUE]</span></span>
<span class="line"><span>NAME = chatai</span></span>
<span class="line"><span>HOST = 127.0.0.1</span></span>
<span class="line"><span>PORT = 6379</span></span>
<span class="line"><span>PASSWORD =</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul></li></ol><hr><h2 id="版本更新注意事项" tabindex="-1">版本更新注意事项 <a class="header-anchor" href="#版本更新注意事项" aria-label="Permalink to &quot;版本更新注意事项&quot;">​</a></h2><h3 id="_3-3-0-版本" tabindex="-1">3.3.0 版本 <a class="header-anchor" href="#_3-3-0-版本" aria-label="Permalink to &quot;3.3.0 版本&quot;">​</a></h3><ul><li>确保已配置 Redis，未配置请参考上文。</li></ul><h3 id="_3-4-0-版本" tabindex="-1">3.4.0 版本 <a class="header-anchor" href="#_3-4-0-版本" aria-label="Permalink to &quot;3.4.0 版本&quot;">​</a></h3><ul><li>参考部署文档设置守护进程。</li></ul><h3 id="_3-5-0-版本" tabindex="-1">3.5.0 版本 <a class="header-anchor" href="#_3-5-0-版本" aria-label="Permalink to &quot;3.5.0 版本&quot;">​</a></h3><ul><li>执行数据迁移脚本：访问 <code>https://(你的域名)/migration</code>。</li><li>重新编译并提交小程序。</li></ul><h3 id="_3-6-0-版本" tabindex="-1">3.6.0 版本 <a class="header-anchor" href="#_3-6-0-版本" aria-label="Permalink to &quot;3.6.0 版本&quot;">​</a></h3><ul><li>Gemini 模型需设置反向代理。</li><li>SD 绘图需本地部署，并添加守护进程。</li></ul><hr><h2 id="至此更新升级完成" tabindex="-1">至此更新升级完成 <a class="header-anchor" href="#至此更新升级完成" aria-label="Permalink to &quot;至此更新升级完成&quot;">​</a></h2><p>通过以上步骤，您可以顺利完成系统的更新升级操作。如有任何问题，请参考相关文档或联系技术支持。</p>`,43)]))}const g=l(s,[["render",t]]);export{u as __pageData,g as default};
