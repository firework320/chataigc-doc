import{_ as a,c as e,a3 as n,o as t}from"./chunks/framework.OIXTx_-L.js";const u=JSON.parse('{"title":"SD(stable-diffusion-webui)绘图部署","description":"","frontmatter":{},"headers":[],"relativePath":"work/third/sd.md","filePath":"work/third/sd.md","lastUpdated":null}'),p={name:"work/third/sd.md"};function r(i,s,l,o,c,d){return t(),e("div",null,s[0]||(s[0]=[n(`<h1 id="sd-stable-diffusion-webui-绘图部署" tabindex="-1">SD(stable-diffusion-webui)绘图部署 <a class="header-anchor" href="#sd-stable-diffusion-webui-绘图部署" aria-label="Permalink to &quot;SD(stable-diffusion-webui)绘图部署&quot;">​</a></h1><p>提示</p><p>使用Docker部署，支持服务器连接本地主机部署的绘画模型。使用大模型只需要一台主机，不需要其他费用。</p><p>信息</p><p>由于硬件等问题，部署存在一起难度，小白用户推荐购买已安装SD绘画和大模型的显卡AI主机：<a href="https://www.goofish.com/item?id=836172376138" target="_blank" rel="noreferrer">https://www.goofish.com/item?id=836172376138</a></p><p>注意</p><p>本教程如果涉及本地主机部署，需要本地主机可以连接境外站点，特别是安装依赖或者打开某些站点的时候。 请自行解决此问题。</p><h2 id="安装python环境" tabindex="-1">安装Python环境 <a class="header-anchor" href="#安装python环境" aria-label="Permalink to &quot;安装Python环境&quot;">​</a></h2><p>打开<a href="https://www.python.org/downloads" target="_blank" rel="noreferrer">https://www.python.org/downloads</a>，找到适合自己系统环境的安装包，下载并安装Python3.10.6。<img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/sd/download-python-1.png" alt=""><img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/sd/download-python-2.png" alt=""><img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/sd/install-python.png" alt=""></p><h2 id="安装git" tabindex="-1">安装Git <a class="header-anchor" href="#安装git" aria-label="Permalink to &quot;安装Git&quot;">​</a></h2><p>打开<a href="https://git-scm.com/" target="_blank" rel="noreferrer">https://git-scm.com</a>，找到适合自己系统环境的安装包，下载并安装git。<img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/sd/install-git-1.png" alt=""><img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/sd/install-git-2.png" alt=""><img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/sd/install-git-3.png" alt=""></p><h2 id="使用git下载stable-diffusion-webui" tabindex="-1">使用Git下载stable-diffusion-webui <a class="header-anchor" href="#使用git下载stable-diffusion-webui" aria-label="Permalink to &quot;使用Git下载stable-diffusion-webui&quot;">​</a></h2><p>注意</p><p>由于github是境外网站，网络问题可能会导致命令执行失败，请弄好网络，多次重试。</p><p>右键点击桌面或者其他目录，选择【在终端中打开】，输入以下命令后，【回车键】执行命令，对项目git仓库进行克隆，项目会下载到对应目录。</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>git clone https://github.com/AUTOMATIC1111/stable-diffusion-webui.git</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/sd/download-sd-webui-1.png" alt=""><img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/sd/download-sd-webui-2.png" alt=""></p><h2 id="启动stable-diffusion-webui" tabindex="-1">启动stable-diffusion-webui <a class="header-anchor" href="#启动stable-diffusion-webui" aria-label="Permalink to &quot;启动stable-diffusion-webui&quot;">​</a></h2><p>提示</p><p>在启动之前，可以根据系统或者硬件，编辑webui-user修改参数，优化生成图像速度。 具体可参考官网文档:<a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui/wiki" target="_blank" rel="noreferrer">https://github.com/AUTOMATIC1111/stable-diffusion-webui/wiki</a></p><ul><li><strong>步骤1</strong>: 打开stable-diffusion-webui目录，找到webui-user.bat文件，右键编辑文件，添加<code>--api --listen --xformers --no-half</code>参数,然后保存文件。</li></ul><p>bat</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@echo off</span></span>
<span class="line"><span></span></span>
<span class="line"><span>set PYTHON=</span></span>
<span class="line"><span>set GIT=</span></span>
<span class="line"><span>set VENV_DIR=</span></span>
<span class="line"><span>set COMMANDLINE_ARGS=--api --listen --xformers --no-half</span></span>
<span class="line"><span></span></span>
<span class="line"><span>call webui.bat</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/sd/edit-webui-user.bat.png" alt=""></p><p>提示</p><p>可以在本地主机打开<a href="https://doc.chatmoney.cn/pro/third-deployment/127.0.0.1:7860.html" target="_blank" rel="noreferrer">127.0.0.1:7860</a>，测试绘画是否可用。</p><ul><li><strong>步骤2</strong>: 双击webui-user.bat文件，双击启动服务，启动成后，会启动弹出浏览器界面，默认端口为7860。如果你是使用云服务器，请在服务器运营商控制台开放7860端口，然后管理后台【AI应用】-&gt;【SD绘图】-&gt;【应用配置】-&gt;【AI域名】配置上：<a href="http://xn--ip+-tw1ew6iu74fkogqz0an4u/" target="_blank" rel="noreferrer">http://公网IP+端口访问</a>，设置好关于SD绘图分类模型等。<img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/sd/start-sd.png" alt=""></li></ul><h2 id="添加绘画模型" tabindex="-1">添加绘画模型 <a class="header-anchor" href="#添加绘画模型" aria-label="Permalink to &quot;添加绘画模型&quot;">​</a></h2><p>提示</p><p>不添加也可用使用SD默认的模型。</p><p>绘画模型可以在<a href="https://www.liblib.art/" target="_blank" rel="noreferrer">https://www.liblib.art</a>或者其他站点下载，有的模型商用需要授权，请自行判断。下载的模型文件格式为safetensors。models/Stable-diffusion目录放大模型、models/Lora目录放微调模型、models/VAE目录放美化模型。模型放好，关闭重启程序。</p><p><img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/sd/models.png" alt=""></p><h2 id="服务器连接本地主机部署的服务" tabindex="-1">服务器连接本地主机部署的服务 <a class="header-anchor" href="#服务器连接本地主机部署的服务" aria-label="Permalink to &quot;服务器连接本地主机部署的服务&quot;">​</a></h2><p>提示</p><p>全能AI知识库系统3.5以后的版本，支持使用frp连接本地部署的绘画服务器和模型，无需购买GPU服务器，即可使用开源模型。</p><p>注意</p><p>如果你在服务器部署大语言模型，直接绕过本步骤。</p><h3 id="服务器上的设置" tabindex="-1">服务器上的设置 <a class="header-anchor" href="#服务器上的设置" aria-label="Permalink to &quot;服务器上的设置&quot;">​</a></h3><ul><li><strong>步骤1</strong>: 打开项目下/docker/config/frps/frps.toml文件，将auth.token字符串的密钥重新定义，可以使用其他任意非中文字符串，然后保存。</li></ul><p>ini</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>bindPort = 7314</span></span>
<span class="line"><span>auth.token = &quot;自己设置的非中文字符串&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/frp/frps.toml.png" alt=""></p><ul><li><strong>步骤2</strong>: 打开项目下/docker/config/supervisor/supervisor.ini文件，在最底部增加frps的守护进程，然后保存。</li></ul><p>ini</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[program:frps]</span></span>
<span class="line"><span>command=/usr/bin/frps -c /usr/local/etc/frps.toml</span></span>
<span class="line"><span>directory=/usr/local/etc</span></span>
<span class="line"><span>autostart=true</span></span>
<span class="line"><span>autorestart=true</span></span>
<span class="line"><span>stderr_logfile=/var/log/frps.err.log</span></span>
<span class="line"><span>stdout_logfile=/var/log/frps.out.log</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/frp/supervisor.ini.png" alt=""></p><ul><li><strong>步骤3</strong>: 点击【Docker】-&gt;【容器】，找到项目的PHP容器，点击【重启】。<img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/frp/php-container-restart.png" alt=""></li><li><strong>步骤4</strong>: 点击在宝塔面板【安全】-&gt;【添加端口规则】，将7314端口放行。 然后在服务器服务商的（阿里云、腾讯云等）控制台的安全组开放7314端口，保障端口是连通的。<img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/frp/port.png" alt=""></li></ul><p>提示</p><p>如何测试端口是否放行，可以打开<a href="https://tool.chinaz.com/port" target="_blank" rel="noreferrer">https://tool.chinaz.com/port</a>,输入服务器IP地址和端口，点击【开启扫描】，状态为开启，即端口是连通的。<img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/frp/test-port.png" alt=""></p><p>⚠️ 警告</p><p>如果已经使用3.5以下老版本，步骤所有不同，步骤1的文件可能不存在，可以从新下载的源码复制进去，放在相同的位置，按步骤1的操作。步骤2照样操作。 然后打开项目下docker-compose.yml文件，找到PHP容器配置，将除了&quot;user:xxxx&quot;选项以外替换为新版本的内容，注意保持缩进（就是前面有多少空格不要更改）。 <img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/frp/docker-compose-php.png" alt="">返回【Docker】-&gt;【容器】，然后删除属于本项目下的所有容器，一般情况下，删除容器不会数据，如果不放心可先备份。接着返回【容器编排】，删除之前添加的容器编排，重新添加即可。</p><h3 id="本地主机上的设置" tabindex="-1">本地主机上的设置 <a class="header-anchor" href="#本地主机上的设置" aria-label="Permalink to &quot;本地主机上的设置&quot;">​</a></h3><p>提示</p><p>frp是一款非常优秀的内网穿透软件。</p><ul><li><strong>步骤1</strong>: 在部署SD服务的主机上，打开<a href="https://github.com/fatedier/frp/releases" target="_blank" rel="noreferrer">https://github.com/fatedier/frp/releases</a>，下载自己系统相对应的frp0.58.1软件版本，“解压下载的压缩包。<img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/frp/download-frp.png" alt=""></li><li><strong>步骤2</strong>: 右键点击【frpc.toml】文件，点击【在记事本中编辑】，打开文件，然后设置frpc信息，其中serverAddr为服务器ip地址，auth.token为服务器上frps.toml的auth.token的值一致，localPort和remotePort为SD服务器的端口，然后保存文件。</li></ul><p>ini</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>serverAddr = &quot;你的ip地址&quot;</span></span>
<span class="line"><span>serverPort = 7314</span></span>
<span class="line"><span>auth.token = &quot;你服务上设置的任意非中文字符串&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[[proxies]]</span></span>
<span class="line"><span>name = &quot;sd&quot;</span></span>
<span class="line"><span>type = &quot;tcp&quot;</span></span>
<span class="line"><span>localIP = &quot;127.0.0.1&quot;</span></span>
<span class="line"><span>localPort = 7860</span></span>
<span class="line"><span>remotePort = 7860</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/frp/frpc.toml.png" alt=""></p><p>提示</p><p>frpc启动失败，可能是以下原因。 1.服务器公网IP地址、端口、auth.token设置不正确。 2.服务器端口没有对外开放，无法连通。 3.服务器上容器的frps没有正确运行。</p><ul><li><strong>步骤3</strong>: 在frp目录空白处右键【在终端中打开】，在终端运行以下命令，运行frpc，启动成功好，可以看到以下界面。</li></ul><p>shell</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>.\\frpc.exe -c frpc.toml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/frp/start-frpc.png" alt=""></p><h2 id="管理后台配置" tabindex="-1">管理后台配置 <a class="header-anchor" href="#管理后台配置" aria-label="Permalink to &quot;管理后台配置&quot;">​</a></h2><p>提示</p><p>一般情况下，使用普通的独立显卡，绘制默认分辨率的画，在10秒内。</p><p>登录管理后台，打开【AI应用】-&gt;【SD绘图】-&gt;【应用配置】，【AI域名】如果了使用【## 服务器连接本地主机部署的服务 】，设置为<code>http://127.0.0.1:7860</code>，如果不使用，直接配置服务器的IP地址+端口，最好设置好关于SD绘图分类模型等，这样完成了，可以在前台测试绘画。<img src="https://doc.chatmoney.cn/docs/images/general/third-deployment/sd/settings-sd-local-domain.png" alt=""></p>`,68)]))}const m=a(p,[["render",r]]);export{u as __pageData,m as default};
