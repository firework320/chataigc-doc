import{_ as t,c as a,ag as s,o as n}from"./chunks/framework.CRouwKY9.js";const m=JSON.parse('{"title":"宝塔面板部署①/③ 推荐使用","description":"","frontmatter":{},"headers":[],"relativePath":"chat/deployment/docker.md","filePath":"chat/deployment/docker.md","lastUpdated":1728472443000}'),o={name:"chat/deployment/docker.md"};function p(c,e,i,l,r,d){return n(),a("div",null,e[0]||(e[0]=[s(`<h1 id="宝塔面板部署1-3-推荐使用" tabindex="-1">宝塔面板部署①/③ 推荐使用 <a class="header-anchor" href="#宝塔面板部署1-3-推荐使用" aria-label="Permalink to &quot;宝塔面板部署①/③ 推荐使用&quot;">​</a></h1><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>提示</span></span>
<span class="line"><span>推荐服务器最低配置：CPU双核、内存4GB、带宽5兆</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>提示</span></span>
<span class="line"><span>强烈推荐正式环境推荐使用宝塔面板部署项目，让部署更方便，减少部署出现问题。</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="服务器环境设置" tabindex="-1">服务器环境设置 <a class="header-anchor" href="#服务器环境设置" aria-label="Permalink to &quot;服务器环境设置&quot;">​</a></h2><ul><li><strong>步骤1</strong>: 点击【软件商店】-&gt;【运行环境】，安装Nginx、MySQL、PHP-8.0、Redis,其中Mysql选择5.7版本。</li></ul><p>⚠️ 警告</p><p>安装软件的时候，使用极速安装，一定要使用PHP8.0和Mysql5.7，否则无法使用。</p><p><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-env-1.png" alt=""><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-env-2.png" alt=""></p><ul><li><strong>步骤2</strong>: 点击【软件商店】-&gt;【已安装】，找到PHP-8.0，然后点击【设置】-&gt;【安装扩展】，【安装】fileinfo扩展，【安装】redis扩展。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-env-3.png" alt=""></li></ul><h2 id="站点部署" tabindex="-1">站点部署 <a class="header-anchor" href="#站点部署" aria-label="Permalink to &quot;站点部署&quot;">​</a></h2><ul><li><strong>步骤1</strong>: 打开宝塔面板/www/wwwroot目录，上传下载的压缩包,解压压缩包，解压出来的文件夹就是项目目录。</li></ul><p>⚠️ 警告</p><p>注意项目目录及子目录用户要为www！如果后续步骤出现问题，重新设置一下项目目录及子目录用户为www。</p><p><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-1-1.png" alt=""><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-1-2.png" alt=""></p><ul><li><strong>步骤2</strong>: 点击【网站】-&gt;【PHP项目】-&gt;【添加站点】，【域名】项填好已解析到本服务器的域名，【根目录】选择上一步解压好的项目目录的server目录，数据库选择【MySQL】，【数据库帐号】项设置好帐号密码，【PHP版本】选择【PHP-80】，点击【提交】。</li></ul><p>⚠️ 警告</p><p>站点目录要选择server，请勿选择public，选择public会导致宝塔生成配置错误，等后面设置修改回来也无济于事，只能删除站点新添加。</p><p><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-2.png" alt=""></p><ul><li><strong>步骤3</strong>: 保存好数据库名、用户、密码，下面步骤13需要用到。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-3.png" alt=""></li><li><strong>步骤4</strong>: 找到网站，点击【设置】-&gt;【SSL】-&gt;【Let&#39;s Encrypt】-&gt;【文件验证】-&gt;【选择域名】-&gt;【申请】，申请SSL证书。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-4-1.png" alt=""><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-4-2.png" alt=""></li><li><strong>步骤5</strong>: 点击【网站目录】-&gt;【网站目录】，选择解压的项目目下的&quot;server&quot;目录，点击保存。【运行目录】选择&quot;/public&quot;项目，点击【保存】。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-5.png" alt=""></li><li><strong>步骤6</strong>: 点击【伪静态】-选择【thinkphp】，点击【保存】。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-6.png" alt=""></li></ul><h3 id="程序安装" tabindex="-1">程序安装 <a class="header-anchor" href="#程序安装" aria-label="Permalink to &quot;程序安装&quot;">​</a></h3><ul><li><p><strong>步骤7</strong>: 访问设置的网站，进入程序安装界面，点击【我已阅读同意】。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-7-1.png" alt=""><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-7-2.png" alt=""></p></li><li><p><strong>步骤8</strong>: 进入此步骤，对环境进行检测，一般情况，除了【swoole_loader扩展】，其他项都会通过，说明内容可能提示【非线程安全扩展】或【线程安全扩展】，记住说明内容，下面步骤9、10、11需要用到。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-8.png" alt=""></p></li><li><p><strong>步骤9</strong>: 打开宝塔文件，进入项目所在的/server/license目录，上一步说明内容如果是【非线程安全扩展】复制swoole_loader80.so文件，如果是【线程安全扩展】复制swoole_loader80_zts.so文件。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-9.png" alt=""></p></li><li><p><strong>步骤10</strong>: 打开宝塔文件，进入/www/server/php/80/lib/php/extensions/no-debug-non-zts-20200930目录，粘贴文件，统一改名为swoole_loader80.so 。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-10.png" alt=""></p></li><li><p><strong>步骤11</strong>: 打开【软件商店】-&gt;【运行环境】-&gt;【设置】-&gt;【配置文件】，在末尾添加<code>extension = swoole_loader80.so</code> 信息，【保存】。 <img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-11-1.png" alt=""> 打开【服务】-&gt;【重启】。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-11-3.png" alt=""></p></li><li><p><strong>步骤12</strong>: 回到安装界面，然后点击【重新检测】。【swoole_loader扩展】安装好以后，一般情况环境检测通过，直接点击【继续】。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-12-1.png" alt=""><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-12-2.png" alt=""></p></li><li><p><strong>步骤13</strong>: 保存的数据库信息设置好数据库，填写Redis地址密码，没设置密码无需填写，然后设置后台管理员帐号密码，点击【继续】。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-13-1.png" alt=""><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-13-2.png" alt=""></p></li><li><p><strong>步骤14</strong>: 程序安装中，完成以后，可以点击【进入管理平台】，使用安装设置的帐号密码登录之前，需要添加授权文件。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-14-1.png" alt=""><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/bt-14-2.png" alt=""></p><h3 id="授权" tabindex="-1">授权 <a class="header-anchor" href="#授权" aria-label="Permalink to &quot;授权&quot;">​</a></h3></li></ul><p>注意</p><p>1.授权文件与产品一一对应，如果不是同一产品，将无法使用。 2.授权文件与项目域名也是一一对应，不然无法使用。</p><ul><li><strong>步骤1</strong>: 购买后源码，登录官网，下载授权文件。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/server/license-1.png" alt=""></li><li><strong>步骤2</strong>: 添加授权文件到server/license目录，并命名为：my.license ，如果仍无法使用，请联系客服。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/server/license-2.png" alt=""></li></ul><h2 id="访问地址" tabindex="-1">访问地址 <a class="header-anchor" href="#访问地址" aria-label="Permalink to &quot;访问地址&quot;">​</a></h2><ul><li>管理后台地址：<a href="http://xn--eqrt2g/admin" target="_blank" rel="noreferrer">http://域名/admin</a></li><li>PC端地址：<a href="http://xn--eqrt2g/pc" target="_blank" rel="noreferrer">http://域名/pc</a></li><li>手机端地址：<a href="http://xn--eqrt2g/mobile" target="_blank" rel="noreferrer">http://域名/mobile</a></li></ul><h2 id="定时任务" tabindex="-1">定时任务 <a class="header-anchor" href="#定时任务" aria-label="Permalink to &quot;定时任务&quot;">​</a></h2><p>⚠️ 警告</p><p>定时任务不设置，会导致一些业务无法正常使用。</p><p>点击【计划任务】，设置任务类型为 【访问URL】、填写任务名称、执行周期设置为【N分钟】【1分钟】，URL地址为&quot;<a href="https://xn--eqrt2g/crontab" target="_blank" rel="noreferrer">https://域名/crontab</a>&quot;，请以项目实际域名为准，然后【添加任务】。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/server/crontab-1.png" alt=""></p><h2 id="守护进程" tabindex="-1">守护进程 <a class="header-anchor" href="#守护进程" aria-label="Permalink to &quot;守护进程&quot;">​</a></h2><h3 id="安装守护进程管理器" tabindex="-1">安装守护进程管理器 <a class="header-anchor" href="#安装守护进程管理器" aria-label="Permalink to &quot;安装守护进程管理器&quot;">​</a></h3><p>点击【软件商店】，搜索【进程守护】，安装进程守护管理器。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/supervisor.png" alt=""></p><h3 id="守护进程设置" tabindex="-1">守护进程设置 <a class="header-anchor" href="#守护进程设置" aria-label="Permalink to &quot;守护进程设置&quot;">​</a></h3><p>注意</p><p><strong>运行守护进程失败原因：</strong> 1.请在终端运行一下php80命令是否有效，无效请在宝塔面板首页右上角点击修复。 2.默认情况下要求用www用户运行守护进程，如果运行失败，可能是www用户无执行php命令，请调整www用户权限或者改用root运行。 3.检查Redis的账号密码是否配置正确。 4.没有选择站点目录下的server目录，站点下的server目录有&quot;think&quot;这个文件。</p><h4 id="添加意间绘画" tabindex="-1">添加意间绘画 <a class="header-anchor" href="#添加意间绘画" aria-label="Permalink to &quot;添加意间绘画&quot;">​</a></h4><p>⚠️ 警告</p><p>如果不使用 MJ直连绘图功能，此守护进程可不添加。 管理后台设置意间相关参数。</p><p>点击进程守护管理器的【设置】-&gt;【添加守护进程】，启动用户选择www，运行目录选择站点目录下的server目录，添加以下命令，点击【确定】，添加成功，可看到守护进程正在运行。</p><p>shell</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>php80 think queue:listen --queue AiYjJob</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/supervisor-yj.png" alt=""><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/supervisor-success.png" alt=""></p><h4 id="mj直连监听" tabindex="-1">MJ直连监听 <a class="header-anchor" href="#mj直连监听" aria-label="Permalink to &quot;MJ直连监听&quot;">​</a></h4><p>⚠️ 警告</p><p>如果不使用 MJ直连绘图功能，此守护进程可不添加。 管理后台先<a href="https://www.mddai.cn/docs/mddai/deployment/midjourney.html" target="_blank" rel="noreferrer">配置MJ相关参数</a> 相关参考再添加守护进程。</p><p>点击进程守护管理器的【设置】-&gt;【添加守护进程】，启动用户选择www，运行目录选择站点目录下的server目录，添加以下命令，点击【确定】，添加成功，可看到守护进程正在运行。</p><p>shell</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>php80 think discord</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/supervisor-mj-listen.png" alt=""><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/supervisor-success.png" alt=""></p><h4 id="mj直连提交任务" tabindex="-1">MJ直连提交任务 <a class="header-anchor" href="#mj直连提交任务" aria-label="Permalink to &quot;MJ直连提交任务&quot;">​</a></h4><p>⚠️ 警告</p><p>如果不使用 MJ直连绘图功能，此守护进程可不添加。 管理后台先<a href="https://www.mddai.cn/docs/mddai/deployment/midjourney.html" target="_blank" rel="noreferrer">配置MJ相关参数</a> 相关参考再添加守护进程。</p><p>点击进程守护管理器的【设置】-&gt;【添加守护进程】，启动用户选择www，运行目录选择站点目录下的server目录，添加以下命令，点击【确定】，添加成功，可看到守护进程正在运行。</p><p>shell</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>php80 think queue:listen --queue AiMjJob</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/supervisor-mj.png" alt=""><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/supervisor-success.png" alt=""></p><h4 id="dalle3绘画" tabindex="-1">dalle3绘画 <a class="header-anchor" href="#dalle3绘画" aria-label="Permalink to &quot;dalle3绘画&quot;">​</a></h4><p>⚠️ 警告</p><p>如果不使用dalle3绘图功能，此守护进程可不添加。 管理后台先dalle3绘图功能参数。</p><p>点击进程守护管理器的【设置】-&gt;【添加守护进程】，启动用户选择www，运行目录选择站点目录下的server目录，添加以下命令，点击【确定】，添加成功，可看到守护进程正在运行。</p><p>shell</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>php80 think queue:listen --queue AiDalleJob</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/supervisor-dalle.png" alt=""><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/supervisor-success.png" alt=""></p><h4 id="sd绘画" tabindex="-1">SD绘画 <a class="header-anchor" href="#sd绘画" aria-label="Permalink to &quot;SD绘画&quot;">​</a></h4><p>⚠️ 警告</p><p>如果不使用SD绘图功能，此守护进程可不添加。 管理后台先SD绘图功能参数。</p><p>点击进程守护管理器的【设置】-&gt;【添加守护进程】，启动用户选择www，运行目录选择站点目录下的server目录，添加以下命令，点击【确定】，添加成功，可看到守护进程正在运行。</p><p>shell</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>php80 think queue:listen --queue AiSdJob --timeout 300</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/supervisor-sd.png" alt=""><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/supervisor-success.png" alt=""></p><h2 id="其它设置" tabindex="-1">其它设置 <a class="header-anchor" href="#其它设置" aria-label="Permalink to &quot;其它设置&quot;">​</a></h2><h3 id="超时设置" tabindex="-1">超时设置 <a class="header-anchor" href="#超时设置" aria-label="Permalink to &quot;超时设置&quot;">​</a></h3><p>提示</p><p>超时时间超级不够长，对话时间过长可能失败。</p><p>点击【软件商店】，找到项目使用的PHP-8.0，点击【设置】-&gt;【配置修改】，找到default_socket_timeout，超时间时间设置为300，点击【保存】。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/php-timeout-1.png" alt=""><img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/php-timeout-2.png" alt=""></p><p>点击【软件商店】，Nginx，点击【设置】-&gt;【性能调整】，找到keepaliv_timeout项，超时间时间设置为300，点击【保存】。<img src="https://doc.chatmoney.cn/docs/images/chat/deployment/bt/nginx-timeout.png" alt=""></p>`,77)]))}const g=t(o,[["render",p]]);export{m as __pageData,g as default};
